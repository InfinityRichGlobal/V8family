<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบลงทะเบียน</title>

    <!-- font-awesome@6.2.0 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">

    <!-- jquery@3.6.0 -->
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai+Looped:wght@200;300&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Thai');

        * {
            box-sizing: border-box;
            font-family: 'Noto Sans Thai', sans-serif;
        }

        body {
            background-color: white;
            margin: 0; /* Remove default margin */
            padding: 0; /* Remove default padding */
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
        }

        .custom-image {
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%; /* Ensure image width is 100% of its container */
            height: auto; /* Maintain aspect ratio */
            display: block; /* Remove any extra spacing below the image */
        }

        .container {
            max-width: 600px;
            margin: auto; /* Center the container */
            padding: 0 15px; /* Add padding */
        }

        .list {
            background-color: #ffffff;
            padding: 1.8em 1.2em;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
            border-radius: 0.6em;
            margin-top: 20px; /* Add space between image and form */
        }

        button[type="submit"] {
            font-family: 'Noto Sans Thai', sans-serif;
            width: 100%;
            padding: 1em;
            background: #e06666;
            border: none;
            border-radius: 5px;
            font-size: 17px;
            color: #fff;
            cursor: pointer;
        }

        button[type="submit"]:hover {
            background: #b1dd4b;
            color: #000;
        }

        #button {
            display: inline-block;
            background-color: #61d72e;
            width: 50px;
            height: 50px;
            text-align: center;
            border-radius: 4px;
            position: fixed;
            bottom: 30px;
            right: 30px;
            transition: background-color .3s, opacity .5s, visibility .5s;
            opacity: 0;
            visibility: hidden;
            z-index: 1000;
        }

        #button::after {
            content: "\f077";
            font-family: FontAwesome;
            font-size: 2em;
            color: #fff;
            line-height: 50px;
        }

        #button:hover {
            cursor: pointer;
            background-color: #333;
        }

        #button:active {
            background-color: #555;
        }

        #button.show {
            opacity: 1;
            visibility: visible;
        }

        .navbar-toggler {
            position: absolute;
            top: 20px;
            right: 20px;
        }
    </style>
</head>
<body>
    <a id="button"></a>

    <nav class="navbar navbar-light">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor03" aria-controls="navbarColor03" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    </nav>

    <center>
        <img src="https://lh3.googleusercontent.com/d/1gi2oy0zl4d3c2FJbdRGzX1K_4K0wTQf1" class="custom-image" alt="Custom Image">
    </center>

    <div class="container list">
        <form id="myForm" class="needs-validation" novalidate>
            <div class="row g-3">
                <div class="col-12">
                    <label for="obj1"><i class="fa-solid fa-award"></i> ยินดีต้อนรับสมาชิกทุกท่าน</label>
                    <select id="obj1" name="obj1" class="form-control" required>
                        <option value="หลักสูตรทดสอบ">เข้าสู่ ครอบครัวครูส้มโอ ส่งออก AEC</option>
                    </select>
                    <div class="invalid-feedback">
                        กรุณาเลือกหลักสูตร
                    </div>
                </div>

                <div class="col-12">
                    <label for="obj2"><i class="fa-solid fa-users-line"></i> กรุณากรอกรหัสประจำสายงาน</label>
                    <input type="text" id="obj2" name="obj2" class="form-control" placeholder="V8A, V8B, ......" required>
                    <div class="invalid-feedback">
                        กรุณากรอกรหัสประจำสายงาน
                    </div>
                </div>

                <div class="col-12">
                    <label for="obj3"><i class="fa-solid fa-user"></i> ชื่อ-สกุล</label>
                    <input type="text" id="obj3" name="obj3" class="form-control" required>
                    <div class="invalid-feedback">
                        กรุณากรอกชื่อ-สกุลของคุณ
                    </div>
                </div>

                <div class="col-12">
                    <label for="obj4"><i class="fa-solid fa-circle-user"></i> ชื่อเล่น</label>
                    <input type="text" id="obj4" name="obj4" class="form-control" required>
                    <div class="invalid-feedback">
                        กรุณากรอกชื่อเล่นของคุณ
                    </div>
                </div>

                <div class="col-12">
                    <label for="obj5"><i class="fa-solid fa-address-card"></i> จังหวัดที่อยู่อาศัย</label>
                    <input type="text" id="obj5" name="obj5" class="form-control" required>
                    <div class="invalid-feedback">
                        กรุณากรอกจังหวัดที่อยู่อาศัยของคุณ
                    </div>
                </div>

                <div class="col-12">
                    <label for="obj6"><i class="fa-solid fa-phone"></i> เบอร์โทร(ที่ติดต่อได้)</label>
                    <input type="text" id="obj6" name="obj6" maxlength="10" class="form-control" required>
                    <div class="invalid-feedback">
                        กรุณากรอกเบอร์โทรของคุณ
                    </div>
                </div>

                <div class="col-12">
                    <label for="device"><i class="fa-brands fa-line"></i> ไอดีไลน์</label>
                    <input type="text" id="device" name="device" class="form-control" required>
                    <div class="invalid-feedback">
                        กรุณากรอก LINE ID ของคุณ
                    </div>
                </div>

                <div class="col-12">
                    <label for="place"><i class="fa-solid fa-business-time"></i> อาชีพ</label>
                    <input type="text" id="place" name="place" class="form-control" placeholder="ก่อนเข้ามาขายออนไลน์" required>
                    <div class="invalid-feedback">
                        กรุณากรอกอาชีพของคุณ
                    </div>
                </div>

                <div class="col-12">
                    <label for="name"><i class="fa-solid fa-users"></i> รหัสสมาชิก</label>
                    <input type="text" id="name" name="name" class="form-control" placeholder="รหัสเข้าสู่ระบบ" required>
                    <div class="invalid-feedback">
                        กรุณากรอกรหัสสมาชิกให้ถูกต้อง
                    </div>
                </div>

                <div class="col-12">
                    <label for="file"><i class="fa-solid fa-file"></i> อัพโหลดรูปประจำตัว</label>
                    <input type="file" id="file" class="form-control">
                    <div class="invalid-feedback">
                        กรุณาอัพโหลดรูปประจำตัวของคุณ
                    </div>
                </div>

                <div class="col-12 text-center">
                    <button type="submit" class="btn btn-warning"><i class="bi bi-check-circle-fill"></i>&nbsp;บันทึกข้อมูล</button>
                </div>
            </div>
        </form>
    </div>

    <script>
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbxDtaXMje1NYyoTNR_p_RrWjnb0XLPV89l1gVK3-RNk859O5d1Ne0htBwBXZP9yz5UX/exec'; // เปลี่ยนลิงค์นี้ตามต้องการ
        var uid;
        $(document).ready(() => {
            liff.init({
                liffId: '2006070736-E86X5JQK', // เปลี่ยน Liff ID ของคุณ
                withLoginOnExternalBrowser: true
            });
            liff.ready.then(() => {
                console.log('liff พร้อมใช้งานแล้ว');
            });
        });

        function submit() {
            $.LoadingOverlay('show');

            // Read the selected file
            const fileInput = $('#file')[0];
            if (fileInput.files.length === 0) {
                $.LoadingOverlay('hide');
                alert('กรุณาเลือกไฟล์');
                return;
            }

            const file = fileInput.files[0];
            const fr = new FileReader();
            fr.onload = function (e) {
                const base64File = e.target.result.replace(/^.*,/, '');

                let data = {
                    opt: 'savedata',
                    uid: liff.getDecodedIDToken().sub,
                    obj1: $('#obj1').val(),
                    obj2: $('#obj2').val(),
                    obj3: $('#obj3').val(),
                    obj4: $('#obj4').val(),
                    obj5: $('#obj5').val(),
                    obj6: $('#obj6').val(),
                    name: $('#name').val(),
                    device: $('#device').val(),
                    place: $('#place').val(),
                    file: base64File, // Add the Base64-encoded file to the data object
                };

                // Send the AJAX request with the file data
                $.ajax({
                    method: "POST",
                    url: scriptUrl,
                    data: data,
                    dataType: 'json',
                    success: function (res) {
                        $.LoadingOverlay('hide');
                        if (res.status == 'success') {
                            $('#myForm')[0].reset();
                            return Swal.fire({
                                icon: 'success',
                                title: 'บันทึกข้อมูลเรียบร้อย',
                                allowOutsideClick: false,
                                confirmButtonText: 'ตกลง',
                            }).then(() => {
                                liff.closeWindow();
                            });
                        }
                        return Swal.fire({
                            icon: 'error',
                            title: 'เกิดข้อผิดพลาด',
                            allowOutsideClick: false,
                            confirmButtonText: 'ตกลง',
                        });
                    },
                    error: function (err) {
                        console.log(err);
                        $.LoadingOverlay('hide');
                        alert('บันทึกข้อมูลไม่สำเร็จ');
                    },
                });
            };
            fr.readAsDataURL(file);
        }

        (() => {
            'use strict'
            const forms = document.querySelectorAll('.needs-validation');
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {
                    event.preventDefault();
                    if (!form.checkValidity()) {
                        event.stopPropagation();
                        form.classList.add('was-validated');
                        $('#myForm').find(":invalid").first().focus();
                    } else {
                        submit();
                    }
                }, false);
            });
        })();

        var btn = $('#button');
        $(window).scroll(function() {
            if ($(window).scrollTop() > 300) {
                btn.addClass('show');
            } else {
                btn.removeClass('show');
            }
        });

        btn.on('click', function(e) {
            e.preventDefault();
            $('html, body').animate({scrollTop: 0}, '300');
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
</body>
</html>
